# slonik-plus

Extends slonik to work with models and adds additional features like `upsert`.

## Documentation Note 

This is a library I've written and have used extensively in large enterprise systems. I feel it would be useful to others, 
so I'm open sourcing it. 

Unfortunately, I don't have time to write full, proper external 
documentation yet. However, its options are documented, and can be seen using intellisense or by examining the code in 
this repo.

If anyone finds it useful and would like to help by expanding the readme, it would be greatly appreciated!

## Upgraded Pool

```ts
// Note: In addition to our extras, all slonik exports are included, so you can import them directly from this library
import { createPoolPlus } from "slonik-plus";

const pool = createPoolPlus
```

## Model

```ts
/**
 * listing (table)
 */
// Check intellisense for more options in the `@record` param such as appending to the query or overriding entirely,
//   which allows you to create a model with a specific query attached
@record({ table: 'listing' }) 
export class ListingRecord<T extends ListingSite = ListingSite>
  extends DbRecord<ListingRecord, {
    // Note: The properties in this field determine properties included in the constructor
    exclude: 'listingId'  // Exclude the listingId, because it's auto-generated by PG
    partial: 'allowsHourly' // We make this optional, because it the PG table has a default value specifed for this
  }>
  implements ProjectListing<T>
{
  @column({ type: 'bigint', primaryKey: true, out: false })
  readonly declare listingId: number;

  @column({ type: 'listing.listing_site' })
  readonly declare listingSite: T;

  @column({ type: 'text' })
  declare title: string;

  @column({ type: 'timestamptz', out: false })
  declare postDt: Date;

  @column({ type: 'timestamptz', out: false })
  declare updatedDt?: Date;

  @column({ type: 'text' })
  declare summary?: string;

  @column({ type: 'bool' })
  declare allowsHourly: boolean;
}
```

## Working with models

```ts
// Get listing records
const recs = pool.maybeMany(
  ListingRecord, 
  { append: sql.fragment`WHERE allows_hourly = true` } // See intellisense for more options
); 

// Upsert
const rec1 = new ProjectListing({ /* ... */ });
const rec2 = new ProjectListing({ /* ... */ });
await pool.upsert(
  [ rec1, rec2 ], // Can also update a signle record
  { /* Note: See intellisense for optional extended options */ }
);

// Modify & Update
rec1.allowsHourly = false;
await rec1.update(pool);
```
